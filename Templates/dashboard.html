<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if user.is_staff %}Admin{% else %}Student{% endif %} Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Modernized Sidebar and Layout */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; background-color: #f0f2f5; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 260px; background-color: #1e293b; color: white; display: flex; flex-direction: column; transition: all 0.3s; }
        .sidebar h2 { text-align: center; padding: 25px 0; background-color: #0f172a; margin: 0; font-size: 20px; letter-spacing: 1px; }
        .sidebar-menu { flex: 1; display: flex; flex-direction: column; padding-top: 10px; }
        .sidebar a { padding: 15px 25px; color: #cbd5e1; text-decoration: none; border-left: 4px solid transparent; transition: 0.2s; display: flex; align-items: center; gap: 12px; }
        .sidebar a i { width: 20px; }
        .sidebar a:hover { background-color: #334155; color: white; border-left: 4px solid #38bdf8; }
        .sidebar a.active { background-color: #334155; color: white; border-left: 4px solid #38bdf8; }
        .sidebar .logout { background-color: #991b1b; color: white; margin: 20px; border-radius: 6px; text-align: center; border: none; }
        .sidebar .logout:hover { background-color: #b91c1c; }

        /* Main Content */
        .main-content { flex: 1; padding: 40px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px; border-bottom: 2px solid #e2e8f0; padding-bottom: 20px; }
        .header h1 { margin: 0; color: #1e293b; font-size: 28px; }
        .id-badge { background: #e2e8f0; padding: 6px 12px; border-radius: 20px; font-weight: 600; color: #475569; }

        /* Stats Cards */
        .cards-container { display: flex; gap: 25px; margin-bottom: 40px; }
        .card { background: white; flex: 1; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); border-top: 5px solid #3b82f6; position: relative; }
        .card h3 { margin: 0 0 12px 0; font-size: 13px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; }
        .card p { margin: 0; font-size: 28px; font-weight: 800; color: #1e293b; }
        .card i { position: absolute; right: 20px; top: 20px; font-size: 24px; color: #cbd5e1; }
        
        /* Specialized Colors */
        .card.fees { border-top-color: #ef4444; }
        .card.attendance { border-top-color: #10b981; }
        .card.admin { border-top-color: #f59e0b; }

        /* Section Layouts */
        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .section-box { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .section-title { font-size: 19px; margin-bottom: 20px; color: #1e293b; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        
        /* Task Styling */
        .task-item { padding: 15px; border-bottom: 1px solid #f1f5f9; display: flex; justify-content: space-between; align-items: center; }
        .task-item:last-child { border-bottom: none; }
        .status-badge { padding: 6px 12px; border-radius: 6px; font-size: 12px; font-weight: 700; text-transform: uppercase; }
        .pending { background-color: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
        .done { background-color: #dcfce7; color: #166534; border: 1px solid #86efac; }
        
        /* Alert for Actions */
        .action-link { color: #2563eb; text-decoration: underline; font-weight: 600; cursor: pointer; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2>{% if user.is_staff %}ADMIN ERP{% else %}STUDYLAB{% endif %}</h2>
        <div class="sidebar-menu">
            <a href="{% url 'dashboard' %}" class="active"><i class="fas fa-home"></i> Dashboard</a>
            <a href="{% url 'student_profile' %}"><i class="fas fa-user"></i> Profile</a>
            
            {% if user.is_staff %}
                <a href="{% url 'pending_admissions_list' %}"><i class="fas fa-user-plus"></i> Guest Requests 
                    {% if pending_count > 0 %}
                    <span style="background:red; color:white; padding:2px 6px; border-radius:50%; font-size:10px;">{{ pending_count }}</span>
                    {% endif %}
                </a>
                <a href="{% url 'admin_attendance' %}"><i class="fas fa-calendar-check"></i> Manage Attendance</a>
            {% else %}
                <a href="{% url 'course_list' %}"><i class="fas fa-book-open"></i> Courses</a>
                <a href="{% url 'my_attendance' %}"><i class="fas fa-chart-line"></i> My Attendance</a>
            {% endif %}

            <a href="{% url 'apply_leave' %}"><i class="fas fa-bed"></i> Apply Leave</a>
            <a href="#"><i class="fas fa-file-invoice-dollar"></i> Fees & Payments</a>
            <a href="#"><i class="fas fa-graduation-cap"></i> Exam Results</a>
        </div>
        <a href="{% url 'logout' %}" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>

    <div class="main-content">
        
        <div class="header">
            <div>
                <h1>Hello, {{ user.first_name|default:user.username }}!</h1>
                <p style="color: #64748b; margin: 5px 0 0 0;">Welcome back to your dashboard overview.</p>
            </div>
            {% if not user.is_staff %}
            <div class="id-badge">ID: {{ student.student_id|default:"NOT ASSIGNED" }}</div>
            {% endif %}
        </div>

        <div class="cards-container">
            {% if user.is_staff %}
                <div class="card admin">
                    <i class="fas fa-users-viewfinder"></i>
                    <h3>Pending Approvals</h3>
                    <p>{{ pending_count }}</p>
                </div>
                <div class="card attendance">
                    <i class="fas fa-user-clock"></i>
                    <h3>Today's Attendance</h3>
                    <p>94%</p>
                </div>
                <div class="card">
                    <i class="fas fa-layer-group"></i>
                    <h3>Active Batches</h3>
                    <p>12</p>
                </div>
            {% else %}
                <div class="card fees">
                    <i class="fas fa-wallet"></i>
                    <h3>Fee Status</h3>
                    {% if student.is_fee_paid %}
                        <p style="color:#10b981">PAID</p>
                    {% else %}
                        <p style="color:#ef4444">PENDING</p>
                    {% endif %}
                </div>
                <div class="card attendance">
                    <i class="fas fa-percent"></i>
                    <h3>Attendance</h3>
                    <p>{{ percentage|default:"0" }}%</p>
                </div>
                <div class="card">
                    <i class="fas fa-clock"></i>
                    <h3>Next Session</h3>
                    <p>10:30 AM</p>
                </div>
            {% endif %}
        </div>

        <div class="dashboard-grid">
            
            <div class="section-box">
                <div class="section-title"><i class="fas fa-list-check"></i> 
                    {% if user.is_staff %}Recent System Activity{% else %}Your Enrollment Checklist{% endif %}
                </div>
                
                <div class="task-list">
                    {% if not user.is_staff %}
                        <div class="task-item">
                            <div>
                                <strong>Admission Documents</strong><br>
                                <small>Upload Aadhaar, Degree, and Photos</small>
                            </div>
                            {% if student.documents_verified %}
                                <span class="status-badge done">Verified ‚úÖ</span>
                            {% else %}
                                <a href="{% url 'complete_onboarding' %}" class="status-badge pending" style="text-decoration:none;">Action Required ‚¨ÜÔ∏è</a>
                            {% endif %}
                        </div>

                        <div class="task-item">
                            <div>
                                <strong>Booking Fee Payment</strong><br>
                                <small>Confirm seat for {{ student.course.name }}</small>
                            </div>
                            {% if student.is_fee_paid %}
                                <span class="status-badge done">Paid ‚úÖ</span>
                            {% else %}
                                <span class="status-badge pending">Pending</span>
                            {% endif %}
                        </div>

                        <div class="task-item">
                            <div>
                                <strong>ID Card Issuance</strong><br>
                                <small>Available after document verification</small>
                            </div>
                            {% if student.documents_verified %}
                                <span class="status-badge done">Ready for Pickup</span>
                            {% else %}
                                <span class="status-badge pending">Awaiting Verification</span>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="task-item">
                            <span>New Guest Inquiry from "{{ last_guest_name|default:"Abhishek" }}"</span>
                            <span class="status-badge pending">New</span>
                        </div>
                        <div class="task-item">
                            <span>Batch-001 Attendance marked for today</span>
                            <span class="status-badge done">Logged</span>
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="section-box">
                <div class="section-title"><i class="fas fa-bell"></i> Notifications</div>
                <div style="color: #64748b; font-size: 14px;">
                    <p>üìÖ Exam schedule updated for Jan 2026.</p>
                    <hr style="border:0; border-top:1px solid #f1f5f9;">
                    <p>üì¢ Holiday announced for 25th Dec.</p>
                </div>
            </div>

        </div>
    </div>

</body>
</html>